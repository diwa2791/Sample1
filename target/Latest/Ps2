<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>Compare</title>

<link rel="stylesheet"
 href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

<style>
body{
 background:linear-gradient(135deg,#0f2027,#2c5364,#00c9a7);
 color:white;
 font-family:Segoe UI;
}
.glass{
 background:rgba(255,255,255,.08);
 backdrop-filter:blur(12px);
 padding:25px;
 border-radius:12px;
}
#loadingOverlay{
 position:fixed;
 inset:0;
 display:none;
 background:rgba(0,0,0,.5);
 justify-content:center;
 align-items:center;
 z-index:9999;
}
.old{color:#ff6b6b;font-weight:bold}
.new{color:#4cd137;font-weight:bold}
</style>
</head>

<body>

<div id="loadingOverlay">
<div class="spinner-border text-light"></div>
</div>

<div class="container mt-5 glass">

<h3>Table Compare</h3>

<form th:action="@{/compare/run}" method="post"
 onsubmit="document.getElementById('loadingOverlay').style.display='flex'">

<input name="tableName" class="form-control mb-3"
 placeholder="Table name">

<button class="btn btn-light">Compare</button>
</form>

<div th:if="${data!=null}">

<!-- TABS -->
<ul class="nav nav-tabs mt-4">

<li class="nav-item">
<a class="nav-link"
 th:classappend="${data.type=='modified'}?'active':''"
 th:href="@{/compare/view(cacheId=${data.cacheId},type='modified')}">
Modified</a>
</li>

<li class="nav-item">
<a class="nav-link"
 th:classappend="${data.type=='test'}?'active':''"
 th:href="@{/compare/view(cacheId=${data.cacheId},type='test')}">
Only Test</a>
</li>

<li class="nav-item">
<a class="nav-link"
 th:classappend="${data.type=='prod'}?'active':''"
 th:href="@{/compare/view(cacheId=${data.cacheId},type='prod')}">
Only Prod</a>
</li>

</ul>

<table class="table table-dark table-hover mt-3">

<tr th:each="row,iter:${data.rows}">
<td th:text="${#strings.listJoin(row.primaryKey.values(),' | ')}"></td>

<td>
<button class="btn btn-sm btn-light"
 th:attr="onclick='toggle('+${iter.index}+')'">
Expand</button>
</td>
</tr>

<tr th:each="row,iter:${data.rows}"
 th:attr="id='d'+${iter.index}"
 style="display:none;">
<td colspan="2">

<div th:if="${data.type=='modified'}">
<div th:each="c:${row.changedColumns}">
<span th:text="${c.columnName}"></span> :
<span class="old" th:text="${c.testValue}"></span> â†’
<span class="new" th:text="${c.prodValue}"></span>
<br>
</div>
</div>

<div th:if="${data.type=='test'}"
 th:each="e:${row.testRow}">
<span th:text="${e.key}"></span> :
<span th:text="${e.value}"></span><br>
</div>

<div th:if="${data.type=='prod'}"
 th:each="e:${row.prodRow}">
<span th:text="${e.key}"></span> :
<span th:text="${e.value}"></span><br>
</div>

</td>
</tr>

</table>

<!-- PAGINATION -->
<div class="text-center">

<a class="btn btn-light btn-sm"
 th:if="${data.page>0}"
 th:href="@{/compare/view(cacheId=${data.cacheId},
 type=${data.type},page=${data.page-1})}">
Prev</a>

<span class="mx-3">
Page [[${data.page+1}]]
</span>

<a class="btn btn-light btn-sm"
 th:if="${(data.page+1)*data.pageSize < data.totalRows}"
 th:href="@{/compare/view(cacheId=${data.cacheId},
 type=${data.type},page=${data.page+1})}">
Next</a>

</div>

</div>

</div>

<script>
function toggle(i){
 let r=document.getElementById("d"+i);
 r.style.display=r.style.display==="none"?"table-row":"none";
}
</script>

</body>
</html>
