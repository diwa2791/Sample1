import java.util.*;

public class DiffHighlighter {

    public static String highlight(String oldText, String newText) {

        if(oldText == null) oldText = "";
        if(newText == null) newText = "";

        if(oldText.equals(newText))
            return escape(oldText);

        String[] oldTokens = oldText.split("(?<=\\W)|(?=\\W)");
        String[] newTokens = newText.split("(?<=\\W)|(?=\\W)");

        StringBuilder result = new StringBuilder();

        int max = Math.max(oldTokens.length, newTokens.length);

        for(int i=0;i<max;i++) {

            String o = i < oldTokens.length ? oldTokens[i] : "";
            String n = i < newTokens.length ? newTokens[i] : "";

            if(!Objects.equals(o,n)) {
                result.append("<span class='diff-change'>")
                      .append(escape(o))
                      .append("</span>");
            } else {
                result.append(escape(o));
            }
        }

        return result.toString();
    }

    private static String escape(String s){
        return s.replace("&","&amp;")
                .replace("<","&lt;")
                .replace(">","&gt;");
    }
}
