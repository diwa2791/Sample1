public class DiffHighlighter {

    private static final int CHAR_DIFF_LIMIT = 800;

    public static String[] highlight(String test, String prod) {

        if (test == null) test = "";
        if (prod == null) prod = "";

        // SAFETY SWITCH
        if (test.length() > CHAR_DIFF_LIMIT ||
            prod.length() > CHAR_DIFF_LIMIT) {

            return tokenDiff(test, prod);
        }

        return simpleCharDiff(test, prod);
    }

    ====================================================

    private static String[] tokenDiff(String a, String b) {

    String[] ta = tokenize(a);
    String[] tb = tokenize(b);

    StringBuilder outA = new StringBuilder();
    StringBuilder outB = new StringBuilder();

    int max = Math.max(ta.length, tb.length);

    for(int i=0;i<max;i++){

        String sa = i < ta.length ? ta[i] : "";
        String sb = i < tb.length ? tb[i] : "";

        if(sa.equals(sb)){
            outA.append(escape(sa));
            outB.append(escape(sb));
        }else{
            outA.append(wrap(sa));
            outB.append(wrap(sb));
        }
    }

    return new String[]{
            outA.toString(),
            outB.toString()
    };
}

=====================================================

            private static String[] tokenize(String s){

    return s.split(
        "(?=[(){}.,;=+\\-*/ ])|(?<=[(){}.,;=+\\-*/ ])"
    );
}

=====================================================
            private static String[] simpleCharDiff(String a, String b){

    StringBuilder A = new StringBuilder();
    StringBuilder B = new StringBuilder();

    int max = Math.max(a.length(), b.length());

    for(int i=0;i<max;i++){

        char ca = i<a.length()?a.charAt(i):0;
        char cb = i<b.length()?b.charAt(i):0;

        if(ca==cb){
            if(ca!=0){
                A.append(escape(ca));
                B.append(escape(cb));
            }
        }else{
            if(ca!=0) A.append(wrap(String.valueOf(ca)));
            if(cb!=0) B.append(wrap(String.valueOf(cb)));
        }
    }

    return new String[]{A.toString(),B.toString()};
}

===============================================================

        private static String wrap(String s){
    return "<span class='diff-change'>" + escape(s) + "</span>";
}

private static String escape(String s){
    return s.replace("&","&amp;")
            .replace("<","&lt;")
            .replace(">","&gt;");
}

private static String escape(char c){
    return escape(String.valueOf(c));
}
